\doxysection{rtc.\+c}
\hypertarget{rtc_8c_source}{}\label{rtc_8c_source}\index{io/rtc/rtc.c@{io/rtc/rtc.c}}
\mbox{\hyperlink{rtc_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{rtc_8h}{rtc.h}}"{}}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \mbox{\hyperlink{structdate__t}{date\_t}}\ \mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}};}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{rtc_8c_a405b6c273d8f15732977cc3234a1a4c0}{rtc\_read}}(uint8\_t\ reg,\ uint8\_t\ *r)\ \{}
\DoxyCodeLine{00006\ \ \ \textcolor{keywordflow}{if}(sys\_outb(\mbox{\hyperlink{rtc_8h_a710b98232df2c563009e6f8a6cd18220}{RTC\_ADDR\_REG}},\ reg)\ !=\ 0)\ \{}
\DoxyCodeLine{00007\ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00008\ \ \ \}}
\DoxyCodeLine{00009\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{utils_8c_a2b56f50ba159e9d5115ed1a75eff15d9}{util\_sys\_inb}}(\mbox{\hyperlink{rtc_8h_a2f258a00c59c3f347c8d2d4a75471ce0}{RTC\_DATA\_REG}},\ r);}
\DoxyCodeLine{00010\ \}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{rtc_8c_a146c10f18011024bd865a8ddc7a496ff}{update\_datetime}}()\ \{}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \ \ uint8\_t\ st;}
\DoxyCodeLine{00015\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{rtc_8c_a405b6c273d8f15732977cc3234a1a4c0}{rtc\_read}}(\mbox{\hyperlink{rtc_8h_ae5ffad506b363f28bed1bb5e5926bd2d}{RTC\_REG\_A}},\ \&st)\ !=\ 0)\ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \ \ \textcolor{keywordflow}{if}(!(st\ \&\ BIT(7)))\ \{}
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{rtc_8c_a405b6c273d8f15732977cc3234a1a4c0}{rtc\_read}}(0,\ \&\mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a0cb1551e6d34db3640222dbedc058309}{second}})\ !=\ 0)\ \{}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00020\ \ \ \ \ \}}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{rtc_8c_a405b6c273d8f15732977cc3234a1a4c0}{rtc\_read}}(2,\ \&\mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a7d8c9b40463fd668c627e91d4ba4b950}{minute}})\ !=\ 0)\ \{}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00023\ \ \ \ \ \}}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{rtc_8c_a405b6c273d8f15732977cc3234a1a4c0}{rtc\_read}}(4,\ \&\mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_ac04c2156faeae76a9cce999c4cf9a033}{hour}})\ !=\ 0)\ \{}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00026\ \ \ \ \ \}}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{rtc_8c_a405b6c273d8f15732977cc3234a1a4c0}{rtc\_read}}(7,\ \&\mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a482ad87226bae7841dfec63e035aeace}{day}})\ !=\ 0)\ \{}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00029\ \ \ \ \ \}}
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{rtc_8c_a405b6c273d8f15732977cc3234a1a4c0}{rtc\_read}}(8,\ \&\mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a1a97f6a755cd4209a0880cf811d52c7b}{month}})\ !=\ 0)\ \{}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00032\ \ \ \ \ \}}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{rtc_8c_a405b6c273d8f15732977cc3234a1a4c0}{rtc\_read}}(9,\ \&\mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a2aa6d53e8880e0af6635177f59f79f06}{year}})\ !=\ 0)\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00035\ \ \ \ \ \}}
\DoxyCodeLine{00036\ \ \ \}}
\DoxyCodeLine{00037\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \textcolor{comment}{//\ then\ parse\ if\ necessary}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ uint8\_t\ tmp;}
\DoxyCodeLine{00043\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{rtc_8c_a405b6c273d8f15732977cc3234a1a4c0}{rtc\_read}}(\mbox{\hyperlink{rtc_8h_a03954a63ead3f02b7790ce79e9877eea}{RTC\_REG\_B}},\ \&tmp)\ !=\ 0)\ \{}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00045\ \ \ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \textcolor{keywordflow}{if}\ (!(tmp\ \&\ BIT(2)))\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{comment}{//\ in\ bcd,\ convert\ to\ binary}}
\DoxyCodeLine{00049\ \ \ \ \ \mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a0cb1551e6d34db3640222dbedc058309}{second}}\ =\ \mbox{\hyperlink{rtc_8c_ab710920d4b62451b72339fcfa26bd6f4}{to\_binary}}(\mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a0cb1551e6d34db3640222dbedc058309}{second}});}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a7d8c9b40463fd668c627e91d4ba4b950}{minute}}\ =\ \mbox{\hyperlink{rtc_8c_ab710920d4b62451b72339fcfa26bd6f4}{to\_binary}}(\mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a7d8c9b40463fd668c627e91d4ba4b950}{minute}});}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_ac04c2156faeae76a9cce999c4cf9a033}{hour}}\ =\ \mbox{\hyperlink{rtc_8c_ab710920d4b62451b72339fcfa26bd6f4}{to\_binary}}(\mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_ac04c2156faeae76a9cce999c4cf9a033}{hour}});}
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a482ad87226bae7841dfec63e035aeace}{day}}\ =\ \mbox{\hyperlink{rtc_8c_ab710920d4b62451b72339fcfa26bd6f4}{to\_binary}}(\mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a482ad87226bae7841dfec63e035aeace}{day}});}
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a1a97f6a755cd4209a0880cf811d52c7b}{month}}\ =\ \mbox{\hyperlink{rtc_8c_ab710920d4b62451b72339fcfa26bd6f4}{to\_binary}}(\mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a1a97f6a755cd4209a0880cf811d52c7b}{month}});}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a2aa6d53e8880e0af6635177f59f79f06}{year}}\ =\ \mbox{\hyperlink{rtc_8c_ab710920d4b62451b72339fcfa26bd6f4}{to\_binary}}(\mbox{\hyperlink{rtc_8c_a489889b08b4c620a178b6a3b58254694}{datetime}}.\mbox{\hyperlink{structdate__t_a2aa6d53e8880e0af6635177f59f79f06}{year}});}
\DoxyCodeLine{00055\ \ \ \}}
\DoxyCodeLine{00056\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00057\ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ uint8\_t\ \mbox{\hyperlink{rtc_8c_ab710920d4b62451b72339fcfa26bd6f4}{to\_binary}}(uint8\_t\ bcd)\ \{}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordflow}{return}\ ((bcd\ >>\ 4)\ *\ 10)\ +\ (bcd\ \&\ 0xF);}
\DoxyCodeLine{00061\ \}}

\end{DoxyCode}
